<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Hello, world!</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <style>
        .instagram-card {
            margin-top: 8px;
            margin-bottom: 8px;
        }
    </style>
    <script>
        window.onload = function () {
            axios.get('/posts')
                .then(function (response) {
                    // console.log(response);
                    let posts = response.data.posts;
                    let html = '';
                    posts.forEach(function (post) {
                        let _id = post._id;
                        let userId = post.user_id;
                        let profile_image_url = post.profile_image_url || "https://thumbs.dreamstime.com/b/default-avatar-profile-icon-vector-social-media-user-portrait-176256935.jpg";
                        let username = post.username || "defaultusername";
                        let commentCount = post.comment_count;
                        let likeCount = post.like_count;
                        let imageUrl = post.image_url || 'https://soosung.co.kr/wp-content/uploads/2021/08/placeholder-2.png';
                        let creator = post.creator;
                        let description = post.description;
                        // image_urls_collection: Optional[list[str]]
                        html += `
                            <div class="card instagram-card">
                                <br>
                                <div class="d-flex flex-row align-items-center feed-text px-2"><img class="rounded-circle" src="${profile_image_url}" width="45">
                                        <div class="d-flex flex-column flex-wrap ml-2"><span class="font-weight-bold">${username}</span></div>
                                    </div>
                                    <br>
                                <img src="${imageUrl}" class="card-img-top" alt="...">
                                <div class="card-body">

                                    <button onclick="increaseLikeCount('${_id}')" class="btn btn-outline-danger">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                            <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                                        </svg>
                                    </button>

                                    <button type="button" class="btn btn-outline-secondary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
                                    <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                                    </svg>
                                    <span class="visually-hidden">Button</span>
                                    </button>

                                    <button type="button" class="btn btn-outline-success">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cursor" viewBox="0 0 16 16">
                                    <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52 2.25 8.184z"/>
                                    </svg>
                                    </button>

                                    <p class="card-text">${likeCount} people have liked this post</p>
                                    

                                    <ul class="list-inline">
                                    <li class="list-inline-item"><strong> ${username} </strong></li>
                                    <li class="list-inline-item">${description}</li>
                                    </ul>
                                    

                                    <a href="#" class="text-decoration-none">View ${commentCount} comments</a>

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                                        <label for="floatingTextarea">Comments</label>
                                    </div>

                                    <br>

                                    <button type="button" class="btn btn-primary">Comment</button>
                                    <div <span class="text-black-50 time">40 minutes ago</span> </div>
                                </div>
                            </div>
                        `;
                    });
                    $('#card-container').append(html);
                })
                .catch(function (error) {
                    let err = JSON.stringify(error);
                    alert(err);
                });
        };
        function increaseLikeCount(_id) {
            axios.put(`/posts/${_id}/like`, {})
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
        function increaseCommentCount(_id) {
            axios.put(`/posts/${_id}/comment`, {})
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

    </script>
</head>

<body>
    
    <div class="container" id="card-container">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>