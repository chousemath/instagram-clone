<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />

  <title>Hello World!</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
    </script>
  <style>
    body {
      background-color: black;
    }

    .mobile-container {
      background-color: black;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .content-container {
      width: 400px;
      background-color: white;
    }

    .card-name,
    .card-username {
      font-weight: bold;
      text-align: center;
    }

    .img-fluid {
      border-radius: 50%;
    }

    .edit-post {
      text-align: center;
    }

    .img-thumbnail {
      margin-top: 10px;
      height: 150px;
    }

    .card-pronouns {
      float: right;
    }
  </style>
  <script>
    window.onload = function () {
      const responseA = axios.get('/profile/61e77891d89fc82a673922eb')
      const responseB = axios.get('/posts/61ed1cc0f8f476b335f33d52')
      Promise.all([responseA, responseB])
        .then(function ([responseA, responseB]) {
          console.log('**', responseA, responseB);
          let _id = responseA.data._id;
          let html = '';
          let name = responseA.data.name;
          let username = responseA.data.username;
          let imageUrl = responseA.data.profile_image_url || 'https://soosung.co.kr/wp-content/uploads/2021/08/placeholder-2.png';
          let biography = responseA.data.biography;
          let birthdate = responseA.data.birthdate;
          let pronouns = responseA.data.pronouns;
          let email = responseA.data.email;

          let creator = responseB.data.creator;
          let photo = responseB.data.image_url;
          let description = responseB.data.description;
          let image_urls_collection = responseB.data.image_urls_collection;
          let photoId = responseB.data._id;
          html += `
                        <div class="card mb-3" style="max-width: 540px; text-align:center;"></div>
                        <div class="row g-0" style="justify-content: center;">
                            <div class="col-md-4" style="width: 200px;">
                              <h2 class="card-username">${username}</h2>
                                <img
                                    src="${imageUrl}"
                                    class="img-fluid" alt="...">
                                    <h4 class="card-name">${name}</h4>
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <p class="card-pronouns"><small class="text-muted">${pronouns}</small></p> 
                                    <p class="card-birthdate"><small class="text-muted">${birthdate}</small></p>
                                    <p class="card-bio">${biography}</p>
                                    <p class="card-email"><small class="text-muted">${email}</small></p>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="edit-post">
                            <button onclick="setUpdatePopup('${_id}', '${name}', '${username}', '${imageUrl}', '${biography}', '${birthdate}', '${pronouns}', '${email}')" class="btn edit-button btn-outline-dark" type="button" data-bs-toggle="modal" data-bs-target="#updatePopup">Edit Profile</button>
                            <button onclick="setCreatePostPopup('${photoId}', ${creator}', '${description}', '${photo}', '${image_urls_collection}')" type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#createPostPopup">Post Image</button>
                        </div>
                        <div>
                          <img src="${photo}" class="img-thumbnail" alt="...">
                          </div>
                  `;

          $('#card-container').append(html);
        })
        .catch(function (error) {
          console.log(error);
        });
    };
  </script>

  <script>
    function setUpdatePopup(_id, name, username, imageUrl, biography, birthdate, pronouns, email) {
      $('#update-id').val(_id);
      $('#update-name').val(name);
      $('#update-username').val(username);
      $('#update-profile-image').val(imageUrl);
      $('#update-biography').val(biography);
      $('update-birthdate').val(birthdate);
      $('update-pronouns').val(pronouns);
      $('update-email').val(email);

    }


    function updateProfile() {
      let _id = $('#update-id').val();
      let name = $('#update-name').val();
      let username = $('#update-username').val();
      let imageUrl = $('#update-profile-image').val();
      let biography = $('#update-biography').val();
      let birthdate = $('#update-birthdate').val();
      let pronouns = $('#update-pronouns').val();
      let email = $('#update-email').val();
      axios.put(`/profile/${_id}`, {
        name: name,
        username: username,
        imageUrl: imageUrl,
        biography: biography,
        birthdate: birthdate,
        pronouns: pronouns,
        email: email,
      })
        .then(function (response) {
          window.location.reload();
        })
        .catch(function (error) {
          console.log(error);
        });
    }

    function createPost() {
      let _id = $('#update-id').val();
      let image_urls_collection = $('#new-image-urls-collection').val();
      let user_id = $('#new-user-id').val();
      let comment_count = Number($('#new-comment').val());
      let photo = $('#new-image-url').val();
      let creator = $('#new-creator').val();
      let description = $('#new-description').val();
      axios.post('/profile', {
        image_urls_collection: image_urls_collection,
        user_id: user_id,
        comment_count: comment_count,
        photo: photo,
        creator: creator,
        description: description,
      })
        .then(function (response) {
          window.location.reload();
        })
        .catch(function (error) {
          console.log(error);
        });
    }

    function setCreatePostPopup(photoId, creator, photo, description) {
      $('#new-photoId').val(photoId);
      $('#new-photo').val(photo);
      $('#new-creator').val(creator);
      $('#new-description').val(description);

    }


  </script>
</head>

</head>

<body>
  <div class="mobile-container">
    <div class="content-container">
      <nav class="navbar navbar-expand-lg navbar-light bg-light nav-bar-sticky">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">InstaClone</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" href="/" aria-current="page" href="#">Feed</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/profile">Profile</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div class="container" id="card-container">
      </div>
      <div class="modal fade" id="updatePopup" tabindex="-1" aria-labelledby="modal for updating profile"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Update Profile</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="update-id" />
              <div class="mb-3">
                <label for="update-name" class="form-label">Name</label>
                <input type="text" class="form-control" id="update-name" placeholder="Enter name here">
              </div>
              <div class="mb-3">
                <label for="update-username" class="form-label">Username</label>
                <input type="text" class="form-control" id="update-username" placeholder="Enter new username here">
              </div>
              <div class="mb-3">
                <label for="update-profile-image" class="form-label">Profile Image</label>
                <input type="text" class="form-control" id="update-profile-image"
                  placeholder="Please enter an image url here">
              </div>
              <div class="mb-3">
                <label for="update-biography" class="form-label">Bio</label>
                <input type="text" class="form-control" id="update-biography">
              </div>
              <div class="mb-3">
                <label for="update-birthdate" class="form-label">Birthdate</label>
                <input type="text" class="form-control" id="update-birthdate">
              </div>
              <div class="mb-3">
                <label for="update-pronouns" class="form-label">Pronouns</label>
                <input type="text" class="form-control" id="update-pronouns">
              </div>
              <div class="mb-3">
                <label for="update-email" class="form-label">Email</label>
                <input type="text" class="form-control" id="update-email">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button onclick="updateProfile()" type="button" class="btn btn-primary">Update</button>
            </div>
          </div>
        </div>
      </div>




      <div class="modal fade" id="createPostPopup" tabindex="-1" aria-labelledby="modal for creating a post"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Create a post</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="update-id" />
              <div class="mb-3">
                <label for="new-photo" class="form-label">Photo URL</label>
                <input type="text" class="form-control" id="new-photo" placeholder="Enter a photo URL here">
              </div>
              <div class="mb-3">
                <label for="new-creator" class="form-label">Creator</label>
                <input type="text" class="form-control" id="new-creator" placeholder="Enter creator here">
              </div>
              <div class="mb-3">
                <label for="new-description" class="form-label">Description</label>
                <input type="text" class="form-control" id="new-description" placeholder="Enter new text here">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button onclick="createPost()" type="button" class="btn btn-primary">Create</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
</body>

</html>