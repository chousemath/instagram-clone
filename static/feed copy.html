<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Posts</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script>
        window.onload = function () {
            axios.get('/posts')
                .then(function (response) {
                    // handle success
                    let data = response['data'];
                    let posts = data['posts'];
                    let htmlTemplate = '';
                    posts.forEach(function (post) {
                        let _id = post['_id'];
                        let image_urls_collection = post['image_urls_collection'];
                        let comment_count = post['comment_count'];
                        let creator = post['creator'];
                        let description = post['description'];
                        let imageUrl = post['image_url'] || 'https://friconix.com/jpg/fi-cnsuxl-question-mark.jpg';
                        let likeCount = post['like_count'] || 0;
                        htmlTemplate += `
                            <tr>
                              <td>${image_urls_collection}</td>
                              
                              <td>${comment_count}</td>
                              <td>${creator}</td>
                              <td>${description}</td>
                              <td>
                                <img style="width: 40px; height: 40px;" src="${imageUrl}" />
                              </td>
                              <td>${likeCount}</td>
                              <td>
                                <button onclick="increaseLikeCount('${_id}')" class="btn btn-outline-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                                </svg>
                                </button>
                              </td>
                              <td>
                                <button onclick="setUpdatePopup('${_id}', '${image_urls_collection}', '${comment_count}', '${creator}', '${description}')" type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#updatePopup">
                                    Update
                                </button>
                              </td>
                              <td>
                                <button onclick="deletePost('${_id}')" type="button" class="btn btn-danger">
                                    Delete
                                </button>
                              </td>
                            </tr>
                        `;
                    });
                    $('#data-container').append(htmlTemplate);
                })
                .catch(function (error) {
                    // handle error
                    console.log(error);
                })
        }

        function createPost() {
            let image_urls_collection = $('#new-image-urls-collection').val();
            let comment_count = Number($('#new-comment').val());
            let imageUrl = $('#new-image_url').val();
            let creator = $('#new-creator').val();
            let description = $('#new-description').val();
            axios.post('/posts', {
                image_urls_collection: image_urls_collection,
                comment_count: comment_count,
                image_url: imageUrl,
                creator: creator,
                description: description,
            })
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function setUpdatePopup(_id, image_urls_collection, comment_count, creator, description) {
            $('#update-id').val(_id);
            $('#update-image_urls_collection').val(image_urls_collection);
            $('#update-comment_count').val(comment_count);
            $('#update-creator').val(creator);
            $('#update-description').val(description);
    
        }

        function updatePost() {
            let _id = $('#update-id').val();
            console.log(_id)
            let image_urls_collection = $('#update-image-urls-collection').val();
            let comment_count = Number($('#update-comment').val());
            let creator = $('#update-creator').val();
            let description = $('#update-description').val();
            console.log(creator)
            console.log(description)
            axios.put(`/posts/${_id}`, {
                image_urls_collection: image_urls_collection,
                comment_count: comment_count,
                creator: creator,
                description: description,
            })
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function increaseLikeCount(_id) {
            axios.put(`/posts/${_id}/like`, {})
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function updateProfile() {
            let _id = '61d7bab6e003d4f585d662fd';
            axios.put(`/posts/${_id}/like`, {})
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function deletePost(_id) {
            axios.delete(`/posts/${_id}`, {})
                .then(function (response) {
                    window.location.reload();
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    </script>

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Feed</a>
        </div>
    </nav>
    

    <div class="container mt-4 mb-5">
        <div class="d-flex justify-content-center row">
            <div class="col-md-8">
                <div class="feed p-2">
                    <div class="d-flex flex-row justify-content-between align-items-center p-2 bg-white border">

                    
                        <div class="bg-white border mt-2">
                            <div>
                                <div class="d-flex flex-row justify-content-between align-items-center p-2 border-bottom">
                                    <div class="d-flex flex-row align-items-center feed-text px-2"><img class="rounded-circle" src="https://i.imgur.com/CbOYWGm.jpg" width="45">
                                        <div class="d-flex flex-column flex-wrap ml-2"><span class="font-weight-bold">thatyprofile</span><span class="text-black-50 time">40 minutes ago</span></div>
                                    </div>
                                    <div class="feed-icon px-2"><i class="fa fa-ellipsis-v text-black-50"></i></div>
                                </div>
                            </div>
                            <div class="feed-image p-2 px-3"><img class="img-fluid img-responsive" src="https://i.imgur.com/CbOYWGm.jpg"></div>
                            <div class="d-flex justify-content-end socials p-2 py-3"><i class="fa fa-thumbs-up"></i><i class="fa fa-comments-o"></i><i class="fa fa-share"></i></div>

                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Image_Urls_Collection</th>
                            <th scope="col">Comment_Count</th>
                            <th scope="col">Creator</th>
                            <th scope="col">Description</th>
                            <th scope="col">Image</th>
                            <th scope="col">Likes</th>
                            <th scope="col">Likes+</th>
                            <th scope="col">Update</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="data-container"></tbody>
                </table>
            </div>

            </div>
            <div class="col-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Create a new post</h5>
                        <div class="mb-3">
                            <label for="new-creator" class="form-label">Creator</label>
                            <input type="text" class="form-control" id="new-creator"
                                placeholder="Enter a new creator here">
                        </div>
                        <div class="mb-3">
                            <label for="new-description" class="form-label">Description</label>
                            <input type="text" class="form-control" id="new-description"
                                placeholder="Enter text here">
                        </div>
                        <div class="mb-3">
                            <label for="new-image_url" class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="new-image_url"
                                placeholder="Enter a new post image url here">
                        </div>
                        <button onclick="createPost()" type="button" class="btn btn-primary">Create</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updatePopup" tabindex="-1" aria-labelledby="modal for updating a post"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update a post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="update-id" />
                    <div class="mb-3">
                        <label for="update-creator" class="form-label">Creator</label>
                        <input type="text" class="form-control" id="update-creator"
                            placeholder="Enter a new creator here">
                    </div>
                    <div class="mb-3">
                        <label for="update-description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="update-description"
                            placeholder="Enter new text here">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button onclick="updatePost()" type="button" class="btn btn-primary">Update</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>

  <div class="container mt-4 mb-5">
    <div class="d-flex justify-content-center row">
        <div class="col-md-8">
            <div class="feed p-2">
                <div class="d-flex flex-row justify-content-between align-items-center p-2 bg-white border">
                    <div class="feed-text px-2">
                        <h6 class="text-black-50 mt-2">What's on your mind</h6>
                    </div>
                    <div class="feed-icon px-2"><i class="fa fa-long-arrow-up text-black-50"></i></div>
                </div>
                    <div class="p-2 px-3"><span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</span></div>
                    <div class="d-flex justify-content-end socials p-2 py-3"><i class="fa fa-thumbs-up"></i><i class="fa fa-comments-o"></i><i class="fa fa-share"></i></div>
                </div>
                <div class="bg-white border mt-2">
                    <div>
                        <div class="d-flex flex-row justify-content-between align-items-center p-2 border-bottom">
                            <div class="d-flex flex-row align-items-center feed-text px-2"><img class="rounded-circle" src="https://i.imgur.com/CbOYWGm.jpg" width="45">
                                <div class="d-flex flex-column flex-wrap ml-2"><span class="font-weight-bold">thatyprofile</span><span class="text-black-50 time">40 minutes ago</span></div>
                            </div>
                            <div class="feed-icon px-2"><i class="fa fa-ellipsis-v text-black-50"></i></div>
                        </div>
                    </div>
                    <div class="feed-image p-2 px-3"><img class="img-fluid img-responsive" src="https://i.imgur.com/CbOYWGm.jpg"></div>
                    <div class="d-flex justify-content-end socials p-2 py-3"><i class="fa fa-thumbs-up"></i><i class="fa fa-comments-o"></i><i class="fa fa-share"></i></div>
                </div>
            </div>
        </div>
    </div>
</div>

</html>
